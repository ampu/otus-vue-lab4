import{x as A,r as k,c as N}from"./index-a893f17b.js";const w={GET_BOOKS:"https://www.googleapis.com/books/v1/volumes"},y=o=>{var S,C;const{id:n,volumeInfo:c,saleInfo:u}=o,{title:i,authors:r,publishedDate:a,description:d,industryIdentifiers:l,imageLinks:e,categories:t}=c,s=(r==null?void 0:r.map(R))??[],[p]=t??[];return{book:{id:n,isbn:(S=l==null?void 0:l.find(({type:v})=>v==="ISBN_13"))==null?void 0:S.identifier,year:Number.parseInt(a)||void 0,title:i,authorIds:s.map(({id:v})=>v),posterUrl:e.thumbnail,description:d,price:(C=u.retailPrice)==null?void 0:C.amount,category:p},authors:s}},R=o=>({id:o,name:o}),I=o=>{const n=new Map;for(const{authors:c}of o)for(const u of c)n.set(u.id,u);return n},b={async getBooks(o){const c=(await fetch(`${w.GET_BOOKS}?q=${encodeURIComponent(o)}`).then(i=>i.json())).items.map(y),u=I(c);return{books:c.map(({book:i})=>i).filter(Boolean),authors:Array.from(u.values())}}},x=A("author",()=>{const o=k([]);return{authors:o,getAuthors:r=>{if(!r)return o.value;const{name:a,country:d}=r,l=a==null?void 0:a.toLowerCase(),e=d==null?void 0:d.toLowerCase();return o.value.filter(t=>{var s;return(!l||t.name.toLowerCase().includes(l))&&(!e||((s=t.country)==null?void 0:s.toLowerCase().includes(e)))})},getAuthor:r=>o.value.find(a=>a.id===r),addAuthor:async r=>{o.value.push(r)},updateAuthor:async r=>{const a=o.value.findIndex(({id:d})=>d===r.id);a!==-1&&(o.value[a]=r)}}});var h=(o=>(o.NONE="NONE",o.SUCCESS="SUCCESS",o.ERROR="ERROR",o.PENDING="PENDING",o))(h||{});const L=o=>({disabled:o!=="SUCCESS",active:o==="SUCCESS",pending:o==="PENDING",error:o==="ERROR"}),P=A("book",()=>{const o=k(h.NONE),n=k([]),c=N(()=>L(o.value)),u=e=>n.value.find(t=>t.id===e),i=async e=>{n.value.push(e)};return{fetchStatus:o,fetchStatuses:c,books:n,getBook:u,addBook:i,updateBook:async e=>{const t=n.value.findIndex(({id:s})=>s===e.id);t!==-1&&(n.value[t]=e)},removeBook:async({id:e})=>{n.value=n.value.filter(t=>t.id!==e)},getBooks:e=>{if(!e)return n.value;const{title:t,minYear:s,maxYear:p,category:E,minPrice:S,maxPrice:C}=e,v=t==null?void 0:t.toLowerCase(),m=E==null?void 0:E.toLowerCase();return n.value.filter(f=>{var B,g;return(!v||((B=f.title)==null?void 0:B.toLowerCase().includes(v)))&&(!s||s<=f.year)&&(!p||f.year<=p)&&(!m||((g=f.category)==null?void 0:g.toLowerCase().includes(m)))&&(!S||S<=f.price)&&(!C||f.price<=C)})},fetchBooks:async()=>{if(![h.PENDING,h.SUCCESS].includes(o.value))try{o.value=h.PENDING;const{books:e,authors:t}=await b.getBooks("vue.js");e.forEach(i);const s=x();t.forEach(s.addAuthor),o.value=h.SUCCESS}catch(e){o.value=h.ERROR,console.error(e.stack)}}}});export{x as a,P as u};
