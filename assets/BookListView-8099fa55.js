import{A as T}from"./add-ba4f0a09.js";import{d as L,c,r as P,o as Y,a as n,b as i,e as t,w as _,v as p,u as s,f as m,F as V,g as C,t as g,h as b,i as j,j as q,k as D,l as M,p as O,m as z,_ as S,n as I,q as G,s as H,B as J}from"./index-a893f17b.js";import{E as K,g as Q,a as W}from"./navigation-helpers-6c2cd6a7.js";import{u as X,a as Z}from"./book-store-1d1fc36a.js";import{u as tt,T as et}from"./use-page-f6228473.js";import"./lodash-364b2391.js";const d=h=>(O("data-v-4156b112"),h=h(),z(),h),st={class:"table table-striped align-middle text-center"},ot=d(()=>t("tr",{class:"title"},[t("th",{style:{width:"20%"}},"Authors"),t("th",{style:{width:"5%"}}),t("th",null,"Title"),t("th",{style:{width:"15%"}},"Year"),t("th",{style:{width:"15%"}},"Category"),t("th",{style:{width:"15%"}},"Price"),t("th")],-1)),lt={class:"filter"},nt=d(()=>t("th",null,null,-1)),at=d(()=>t("th",null,null,-1)),it=["disabled"],dt={class:"input-group"},rt=["disabled"],ut=d(()=>t("span",{class:"input-group-text"},"-",-1)),ct=["disabled"],_t=["disabled"],pt={class:"input-group"},mt=["disabled"],ht=d(()=>t("span",{class:"input-group-text"},"-",-1)),gt=["disabled"],bt=d(()=>t("th",null,null,-1)),vt={key:0},yt=d(()=>t("tr",null,[t("td",{colspan:"10"},"Loading...")],-1)),ft=[yt],kt={key:1},xt=d(()=>t("tr",null,[t("td",{colspan:"10"},"Something went wrong... Please come back later!")],-1)),Bt=[xt],wt={key:2},Pt=d(()=>t("tr",null,[t("td",{colspan:"10"},"No books found... Please add one!")],-1)),Vt=[Pt],Ct={key:3},It=d(()=>t("tr",null,[t("td",{colspan:"10"},"No books matching your filter... Please weaken your requirements!")],-1)),Lt=[It],St={key:4},Ut={class:"author-list"},Ft=["textContent"],Nt=["src","alt","title"],$t={class:"text-start"},At={class:"text-end"},Et={class:"d-flex gap-2"},Rt=["onClick"],Tt=["onClick"],Yt=L({__name:"BookList",setup(h){const x=D(),B=M(),u=X(),U=Z(),a=c(()=>u.fetchStatuses),l=P({}),F=c(()=>Object.values(l.value).some(Boolean)),v=c(()=>u.getBooks(l.value)),N=c(()=>Q(v.value,y.value,f.value)),$=c(()=>u.books.length===0),A=c(()=>v.value.length===0),f=P(5),y=tt("books",()=>W(v.value.length,f.value)),E=w=>{const o=w.map(U.getAuthor);if(o.length===0)return{[""]:"-"};if(o.length<3)return Object.fromEntries(o.map(r=>[r==null?void 0:r.id,r==null?void 0:r.name]));const[e]=o;return{[String(e==null?void 0:e.id)]:e==null?void 0:e.name,[""]:`and ${o.length-1} more`}};return Y(u.fetchBooks),(w,o)=>(n(),i("table",st,[t("thead",null,[ot,t("tr",lt,[nt,at,t("th",null,[_(t("input",{class:"form-control","onUpdate:modelValue":o[0]||(o[0]=e=>l.value.title=e),disabled:s(a).disabled},null,8,it),[[p,l.value.title]])]),t("th",null,[t("div",dt,[_(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=e=>l.value.minYear=e),disabled:s(a).disabled},null,8,rt),[[p,l.value.minYear]]),ut,_(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=e=>l.value.maxYear=e),disabled:s(a).disabled},null,8,ct),[[p,l.value.maxYear]])])]),t("th",null,[_(t("input",{class:"form-control","onUpdate:modelValue":o[3]||(o[3]=e=>l.value.category=e),disabled:s(a).disabled},null,8,_t),[[p,l.value.category]])]),t("th",null,[t("div",pt,[_(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o[4]||(o[4]=e=>l.value.minPrice=e),disabled:s(a).disabled},null,8,mt),[[p,l.value.minPrice]]),ht,_(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o[5]||(o[5]=e=>l.value.maxPrice=e),disabled:s(a).disabled},null,8,gt),[[p,l.value.maxPrice]])])]),bt])]),s(a).pending?(n(),i("tbody",vt,ft)):m("",!0),s(a).error?(n(),i("tbody",kt,Bt)):m("",!0),s(a).active&&s($)?(n(),i("tbody",wt,Vt)):s(a).active&&s(A)?(n(),i("tbody",Ct,Lt)):m("",!0),s(a).active?(n(),i("tbody",St,[(n(!0),i(V,null,C(s(N),e=>{var r;return n(),i("tr",{key:e.id},[t("td",null,[t("ul",Ut,[(n(!0),i(V,null,C(E(e.authorIds),(k,R)=>(n(),i("li",{key:R,textContent:g(k)},null,8,Ft))),128))])]),t("td",null,[e.posterUrl?(n(),i("img",{key:0,src:e.posterUrl,alt:e.title,title:e.title,height:"60",width:"40",class:"poster"},null,8,Nt)):m("",!0)]),t("td",$t,g(e.title),1),t("td",null,g(e.year??"-"),1),t("td",null,g(e.category??"-"),1),t("td",At,g(e.price?`${(r=e.price)==null?void 0:r.toFixed(2)} ₽`:"-"),1),t("td",null,[t("div",Et,[t("button",{type:"button",class:"btn btn-outline-secondary action",onClick:k=>s(x).push({name:"books-edit",params:{bookId:e.id},query:{redirect:s(B).fullPath}})},[b(s(K))],8,Rt),t("button",{type:"button",class:"btn btn-outline-danger action",onClick:k=>s(u).removeBook(e)}," × ",8,Tt)])])])}),128))])):m("",!0),s(a).active?(n(),j(et,{key:5,page:s(y),"onUpdate:page":o[6]||(o[6]=e=>q(y)?y.value=e:null),isFiltered:s(F),total:s(u).books.length,filtered:s(v).length,perPage:f.value},null,8,["page","isFiltered","total","filtered","perPage"])):m("",!0)]))}});const jt=S(Yt,[["__scopeId","data-v-4156b112"]]),qt={class:"mb-3"},Dt={class:"mb-3 d-flex flex-wrap"},Mt=L({__name:"BookListView",setup(h){return(x,B)=>{const u=H("RouterLink");return n(),i("div",null,[t("h1",qt,[b(s(J)),I(" Books ")]),t("div",Dt,[b(u,{to:{name:"books-add"},class:"btn btn-primary d-flex align-items-center gap-1"},{default:G(()=>[b(s(T)),I(" New Book ")]),_:1})]),b(jt)])}}});const Qt=S(Mt,[["__scopeId","data-v-e158fe4a"]]);export{Qt as default};
